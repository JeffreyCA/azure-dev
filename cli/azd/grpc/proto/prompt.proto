// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
syntax = "proto3";

package azdext;

option go_package = "github.com/azure/azure-dev/cli/azd/pkg/azdext";

import "models.proto";
import "ai.proto";

service PromptService {
  // PromptSubscription prompts the user to select a subscription.
  rpc PromptSubscription (PromptSubscriptionRequest) returns (PromptSubscriptionResponse);

  // PromptLocation prompts the user to select a location.
  rpc PromptLocation (PromptLocationRequest) returns (PromptLocationResponse);

  // PromptResourceGroup prompts the user to select a resource group.
  rpc PromptResourceGroup (PromptResourceGroupRequest) returns (PromptResourceGroupResponse);

  // Confirm prompts the user to confirm an action.
  rpc Confirm(ConfirmRequest) returns (ConfirmResponse);

  // Prompt prompts the user for text input.
  rpc Prompt(PromptRequest) returns (PromptResponse);

  // Select prompts the user to select an option from a list.
  rpc Select(SelectRequest) returns (SelectResponse);

  // MultiSelect prompts the user to select multiple options from a list.
  rpc MultiSelect(MultiSelectRequest) returns (MultiSelectResponse);

  // PromptSubscriptionResource prompts the user to select a resource from a subscription.
  rpc PromptSubscriptionResource(PromptSubscriptionResourceRequest) returns (PromptSubscriptionResourceResponse);

  // PromptResourceGroupResource prompts the user to select a resource from a resource group.
  rpc PromptResourceGroupResource(PromptResourceGroupResourceRequest) returns (PromptResourceGroupResourceResponse);

  // PromptAiLocation prompts the user to select a location that can satisfy AI quota requirements.
  rpc PromptAiLocation(PromptAiLocationRequest) returns (PromptAiLocationResponse);

  // PromptAiModel prompts the user to select an AI model deployment candidate from a location.
  rpc PromptAiModel(PromptAiModelRequest) returns (PromptAiModelResponse);

  // PromptAiDeployment prompts the user to select an AI deployment (location + model configuration).
  rpc PromptAiDeployment(PromptAiDeploymentRequest) returns (PromptAiDeploymentResponse);
}

message PromptSubscriptionRequest {
  string Message = 1;
  string HelpMessage = 2;
}

message PromptSubscriptionResponse {
  Subscription subscription = 1;
}

message PromptLocationRequest {
  AzureContext azure_context = 1;
}

message PromptLocationResponse {
  Location location = 1;
}

message PromptResourceGroupRequest {
  AzureContext azure_context = 1;
  PromptResourceGroupOptions options = 2;
}

message PromptResourceGroupResponse {
  ResourceGroup resource_group = 1;
}

message ConfirmRequest {
  ConfirmOptions options = 1;
}

message ConfirmResponse {
  optional bool value = 1;
}

message PromptRequest {
  PromptOptions options = 1;
}

message PromptResponse {
  string value = 1;
}

message SelectRequest {
  SelectOptions options = 1;
}

message SelectResponse {
  optional int32 value = 1;
}

message MultiSelectRequest {
  MultiSelectOptions options = 1;
}

message MultiSelectResponse {
  repeated MultiSelectChoice values = 1;
}

message PromptSubscriptionResourceRequest {
  AzureContext azure_context = 1;
  PromptResourceOptions options = 2;
}

message PromptSubscriptionResourceResponse {
  azdext.ResourceExtended resource = 1;
}

message PromptResourceGroupResourceRequest {
  AzureContext azure_context = 1;
  PromptResourceOptions options = 2;
}

message PromptResourceGroupResourceResponse {
  azdext.ResourceExtended resource = 1;
}

message PromptAiLocationRequest {
  AzureContext azure_context = 1;
  repeated string allowed_locations = 2;
  repeated AiUsageRequirement requirements = 3;
  string message = 4;
  string help_message = 5;
}

message PromptAiLocationResponse {
  Location location = 1;
}

message PromptAiModelRequest {
  AzureContext azure_context = 1;
  string location = 2;
  repeated string kinds = 3;
  repeated string statuses = 4;
  repeated string formats = 5;
  repeated string capabilities = 6;
  repeated string preferred_skus = 7;
  string message = 8;
  string help_message = 9;
}

message PromptAiModelResponse {
  AiModelSelection model = 1;
}

enum AiDeploymentSelectionMode {
  AI_DEPLOYMENT_SELECTION_MODE_UNSPECIFIED = 0;
  AI_DEPLOYMENT_SELECTION_MODE_LOCATION_FIRST = 1;
  AI_DEPLOYMENT_SELECTION_MODE_MODEL_FIRST = 2;
}

message PromptAiDeploymentRequest {
  AzureContext azure_context = 1;
  repeated string allowed_locations = 2;
  repeated AiUsageRequirement requirements = 3;
  repeated string kinds = 4;
  repeated string statuses = 5;
  repeated string formats = 6;
  repeated string capabilities = 7;
  repeated string preferred_skus = 8;
  string location_message = 9;
  string location_help_message = 10;
  string model_message = 11;
  string model_help_message = 12;
  AiDeploymentSelectionMode selection_mode = 13;
}

message PromptAiDeploymentResponse {
  AiModelSelection model = 1;
}

message AiModelSelection {
  string name = 1;
  string location = 2;
  string version = 3;
  bool is_default_version = 4;
  string kind = 5;
  string format = 6;
  string status = 7;
  repeated string capabilities = 8;
  AiModelSku sku = 9;
}

message ConfirmOptions {
  optional bool default_value = 1;
  string message = 2;
  string help_message = 3;
  string hint = 4;
  string placeholder = 5;
}

message PromptOptions {
  string message = 1;
  string help_message = 2;
  string hint = 3;
  string placeholder = 4;
  string validation_message = 5;
  string required_message = 6;
  bool required = 7;
  string default_value = 8;
  bool clear_on_completion = 9;
  bool ignore_hint_keys = 10;
}

message SelectChoice {
  string value = 1;
  string label = 2;
}

message MultiSelectChoice {
  string value = 1;
  string label = 2;
  bool selected = 3;
}

message SelectOptions {
  optional int32 selected_index = 1;
  string message = 2;
  repeated SelectChoice choices = 3;
  string help_message = 4;
  string hint = 5;
  int32 display_count = 6;
  optional bool display_numbers = 7;
  optional bool enable_filtering = 8;
}

message MultiSelectOptions {
  string message = 1;
  repeated MultiSelectChoice choices = 2;
  string help_message = 3;
  string hint = 4;
  int32 display_count = 5;
  optional bool display_numbers = 6;
  optional bool enable_filtering = 7;
}

message PromptResourceOptions {
  string resource_type = 1;
  repeated string kinds = 2;
  string resource_type_display_name = 3;
  PromptResourceSelectOptions select_options = 4;
}

message PromptResourceSelectOptions {
  optional bool force_new_resource = 1;
  optional bool allow_new_resource = 2;
  string new_resource_message = 3;
  string creating_message = 4;
  string message = 5;
  string help_message = 6;
  string loading_message = 7;
  optional bool display_numbers = 8;
  int32 display_count = 9;
  string hint = 10;
  optional bool enable_filtering = 11;
}

message PromptResourceGroupOptions {
  PromptResourceSelectOptions select_options = 1;
}
